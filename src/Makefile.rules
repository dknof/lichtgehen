CXX ?= g++
CXXFLAGS ?= -Wall -Werror -Wno-parentheses -std=c++14 -O0 -ggdb
#CXXFLAGS ?= -Wall -Werror -Wno-parentheses -std=c++14 -O3
#CXXFLAGS ?= -Wall -Werror -Wno-parentheses -std=c++1y -O3

DEPGEN_FLAGS ?= -MMD -MP -MT $@ -MF $(@:.o=.d)
ifeq ($(USE_UI_GTKMM), true)
  CPPFLAGS += -DUSE_UI_GTKMM
endif
ifeq ($(USE_EINGABE), true)
  CPPFLAGS += -DUSE_EINGABE
endif
ifeq ($(USE_EIGENES_SPIEL), true)
  CPPFLAGS += -DUSE_EIGENES_SPIEL
endif
ifeq ($(USE_THREADS), true)
  CPPFLAGS += -DUSE_THREADS
endif

.PHONY: all

# compile the objects
.PHONY: objects
objects: $(OBJECTS)

%.o : %.cpp $(DEPTH)/Makefile.modules
	@echo $(CXX) -c $(SUBDIR)/$<
	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $(INCLUDE) $(DEPGEN_FLAGS) -o $@ -c $<

.PHONY: lib
lib: lib.a

lib.a: $(OBJECTS) $(DIRECTORIES)
	ld -o lib.a -r $(OBJECTS) $(DIRECTORIES:%=%/lib.a)

-include $(OBJECTS:%.o=%.d)

# call make for the subdirectories
.PHONY: directories
directories: $(DIRECTORIES)

# call make for the subdirectories
.PHONY : $(DIRECTORIES)
$(DIRECTORIES) :
	$(MAKE) -C $@

# remove the object files in this directory and the subdirectories
.PHONY : clean
clean :
	-$(RM) *.o
	-$(RM) *.d
	-$(RM) lib.a
ifeq ($(DEPTH),.)
	-$(RM) tronbot
	-$(RM) core core.*
	-$(RM) tags
endif
	-for d in $(DIRECTORIES); do $(MAKE) -C $$d $@; done

# clean the directory
.PHONY: delete
delete : clean
